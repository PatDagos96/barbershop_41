<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estro Saloon - Prenotazioni</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #121212; /* Nero profondo */
            color: #d4af37; /* Oro classico */
            font-family: 'Lato', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        .card {
            background-color: #1e1e1e; /* Grigio scuro elegante */
            border: 1px solid #d4af37;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
            max-width: 500px;
            width: 100%;
        }
        h2 {
            font-family: 'Playfair Display', serif;
            color: #d4af37;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        label { color: #f0f0f0; margin-bottom: 5px;}
        
        /* Stile campi input */
        .form-control, .form-select {
            background-color: #2c2c2c;
            border: 1px solid #555;
            color: white;
        }
        .form-control:focus, .form-select:focus {
            background-color: #333;
            color: white;
            border-color: #d4af37;
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
        }

        /* Griglia Bottoni Orari */
        #zona-orari {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 bottoni per riga */
            gap: 10px;
            margin-top: 10px;
        }
        .btn-orario {
            background-color: transparent;
            border: 1px solid #d4af37;
            color: #d4af37;
            padding: 8px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .btn-orario:hover {
            background-color: #d4af37;
            color: #000;
        }
        .btn-orario.selezionato {
            background-color: #d4af37;
            color: black;
            font-weight: bold;
            box-shadow: 0 0 10px #d4af37;
        }

        .btn-prenota {
            background: linear-gradient(45deg, #b8860b, #ffd700);
            color: black;
            font-weight: bold;
            border: none;
            margin-top: 20px;
        }
        .btn-prenota:hover {
            background: linear-gradient(45deg, #ffd700, #b8860b);
            transform: scale(1.02);
        }
    </style>
</head>
<body>

<div class="card p-4 mx-3">
    <h2 class="text-center mb-4">‚ú® Estro Saloon ‚ú®</h2>
    
    <div class="mb-3">
        <label>Nome e Cognome</label>
        <input type="text" id="nome" class="form-control" placeholder="Il tuo nome">
    </div>

    <div class="mb-3">
        <label>Servizio</label>
        <select id="servizio" class="form-select">
            <option>Taglio Donna</option>
            <option>Piega e Stile</option>
            <option>Colore Completo</option>
            <option>Taglio Uomo</option>
        </select>
    </div>

    <div class="mb-3">
        <label>Scegli la Data</label>
        <input type="date" id="data" class="form-control" onchange="caricaOrari()">
    </div>

    <div class="mb-3">
        <label id="label-orari" style="display:none;">Orari Disponibili:</label>
        <div id="zona-orari"></div>
        <input type="hidden" id="ora_selezionata">
    </div>

    <button onclick="inviaPrenotazione()" class="btn btn-prenota w-100">CONFERMA APPUNTAMENTO</button>
</div>

<script>
    // Impedisce di selezionare date passate
    document.getElementById('data').min = new Date().toISOString().split("T")[0];

    async function caricaOrari() {
        const dataScelta = document.getElementById('data').value;
        const zonaOrari = document.getElementById('zona-orari');
        const labelOrari = document.getElementById('label-orari');
        
        if (!dataScelta) return;

        // Pulisce i vecchi orari e mostra caricamento
        zonaOrari.innerHTML = '<div class="text-white">Caricamento...</div>';
        labelOrari.style.display = 'block';

        // Chiama il Cervello (Python)
        const response = await fetch(`/orari-disponibili?data=${dataScelta}`);
        const dati = await response.json();
        
        zonaOrari.innerHTML = ''; // Pulisce
        document.getElementById('ora_selezionata').value = ''; // Resetta scelta

        if (dati.orari.length === 0) {
            zonaOrari.innerHTML = '<div class="text-danger">Tutto pieno per oggi! üòî</div>';
        } else {
            dati.orari.forEach(ora => {
                zonaOrari.innerHTML += `<button onclick="selezionaOra(this, '${ora}')" class="btn btn-orario">${ora}</button>`;
            });
        }
    }

    function selezionaOra(bottone, ora) {
        // Toglie l'oro dagli altri bottoni
        document.querySelectorAll('.btn-orario').forEach(b => b.classList.remove('selezionato'));
        // Mette l'oro su quello cliccato
        bottone.classList.add('selezionato');
        // Salva l'ora nella memoria nascosta
        document.getElementById('ora_selezionata').value = ora;
    }

    async function inviaPrenotazione() {
        const nome = document.getElementById('nome').value;
        const servizio = document.getElementById('servizio').value;
        const data = document.getElementById('data').value;
        const ora = document.getElementById('ora_selezionata').value;

        if (!nome || !data || !ora) {
            alert("‚ö†Ô∏è Per favore compila tutti i campi e scegli un orario!");
            return;
        }

        const params = new URLSearchParams({ nome, servizio, data, ora });
        const response = await fetch(`/prenota?${params}`, { method: 'POST' });
        
        if (response.ok) {
            alert("‚úÖ Prenotazione Confermata! Ci vediamo in salone.");
            location.reload(); // Ricarica la pagina
        } else {
            alert("‚ùå Errore: Qualcuno ti ha rubato il posto all'ultimo secondo!");
            caricaOrari(); // Ricarica gli orari per mostrare quelli rimasti
        }
    }
</script>
</body>
</html>